╭─ip0000h@laptop ~/Documents/Projects/test/googleapp_perm_scanner  ‹master*›
╰─➤  curl 'https://play.google.com/_/PlayStoreUi/data/batchexecute?rpcids=xdSrCf&f.sid=3601205584553241393&bl=boq_playuiserver_20190416.03_p0&hl=en&authuser=0&soc-app=121&soc-platform=1&soc-device=1&_reqid=210374&rt=c' -H 'x-same-domain: 1' -H 'origin: https://play.google.com' -H 'accept-encoding: gzip, deflate, br' -H 'accept-language: ru-RU,ru;q=0.9,en-US;q=0.8,en;q=0.7,be;q=0.6' -H 'user-agent: Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Ubuntu Chromium/73.0.3683.86 Chrome/73.0.3683.86 Safari/537.36' -H 'content-type: application/x-www-form-urlencoded;charset=UTF-8' -H 'accept: */*' -H 'referer: https://play.google.com/' -H 'authority: play.google.com' -H 'cookie: PLAY_ACTIVE_ACCOUNT=ICrt_XL61NBE_S0rhk8RpG0k65e0XwQVdDlvB6kxiQ8=ip0000h@gmail.com; CONSENT=YES+LT.ru+20160219-02-0; PLAY_PREFS=CtsLCLH1qILpEBLRCxqdCxITFBUY8QGsAuEDwgTEBIEF4wXlBegF1waQlYEGkZWBBpKVgQaVlYEGl5WBBqSVgQa4lYEGwJWBBsGVgQbElYEGxZWBBsiVgQbJlYEGzpWBBs-VgQbQlYEG1JWBBtmVgQbylYEG-5WBBvyVgQaGloEGiZaBBoyWgQaPloEGkpaBBp6WgQahloEGo5aBBqSWgQamloEG7peBBu-XgQaFmIEGiZiBBqubgQatm4EGypuBBsubgQbVm4EGvJ2BBt2dgQbnnYEGkJ6BBuKigQbzooEG_KKBBoujgQaapIEGv6WBBuulgQbGpoEG1KaBBtWmgQbVqYEGvKyBBtavgQaHsoEGibKBBtaygQaytIEG1rmBBo7AgQaiwIEGwMCBBsHAgQbywIEG1sKBBozFgQaPxYEGysaBBsvGgQb4x4EGqsqBBtjMgQbczIEG3c2BBobOgQahz4EGxNKBBpXVgQba2IEGy9mBBvLbgQbY5IEGl-WBBrjogQbP64EGsOyBBtf1gQa6-4EGwP-BBsb_gQbH_4EGyf-BBtWDggbIhIIGuYaCBqaHgganh4IG7IeCBu2HggbrjYIG-42CBomOggaVmIIGj5qCBpmaggbBmoIG95qCBp2eggb2ooIGkqWCBp6ogga0qIIG0bWCBq22ggb8uYIG_rmCBv-5ggbCu4IGj7-CBrzBggaQy4IGkcuCBtHLggbczIIG2NCCBovSggbb04IGitaCBoHYggaE2oIGj9qCBpraggaj2oIGxduCBrHcggb43YIG79-CBqbhggaW6YIGo-2CBoXuggaz7oIGsfCCBuv2ggat-IIGs_iCBvb6ggbj-4IG2_yCBoCAgwbygYMG6YSDBpCFgwbXhYMGm4iDBrmIgwbwiIMGhY-DBpCPgwbZkYMG_pGDBvySgwaslYMGuJWDBsCWgwbmloMG3JeDBpmbgwbQnIMG8Z6DBvSegwaVn4MGxp-DBpiggwaboIMG_aCDBuyvgwaVtIMGp7SDBri2gwb9t4MG4LyDBvS8gwb2vIMGsL6DBs2-gwaew4MG5MaDBq3IgwaeyYMGm8qDBsrNgwb-zYMGotCDBvnTgwbr1IMGz9aDBuPXgwbp14MG0dmDBrDfgwaI4IMGm-GDBu_jgwam5YMGkeaDBqbsgwbq7IMGle6DBsDvgwbj74MGpfKDBp30gwbV9IMGjfiDBq37gwak_oMGh_-DBt2BhAbfgYQG8oKEBvqDhAaPhIQG14SEBsmIhAbKiIQGvomEBqeLhAaajIQG9oyEBoCOhAasjoQGrY6EBoaQhAbbk4QGipiEBvSYhAaXmYQG_ZqEBvmchAaKnYQGlaCEBs2jhAbPo4QG0KOEBtOjhAahpIQGqKWEBtGmhAb_p4QG26iEBpKphAaTqYQGy6mEBqmvhAbBr4QG2rOEBsq0hAaltYQGoLaEBqG2hAbVtoQGrbiEBuG4hAaguYQGwLmEBsi7hAb9u4QGmL2EBoe_hAasv4QGt7-EBqPBhAbkwoQG8sKEBozDhAaaw4QG5MWEBqbIhAa3yIQGhcqEBpPLhAbLy4QGsMyEBrLMhAbJzIQG6s6EBvvOhAb50IQG_tCEBp_RhAap0YQGgdOEBoTThAaW04QGhtSEBq_YhAbI2IQGqNuEBuvehAbP4YQG2OGEBorihAbH5oQG6-aEBoDnhAaI54QGwueEBpzohAbG6YQG8umEBq7qhAbe64QGyu2EBsPxhAaP9IQGyPSEBpP2hAbc9oQGiPiEBov4hAbI-IQGm_mEBsP5hAby-oQGifuEBrH7hAa2_IQGwvyEBoT-hAaF_oQGpv6EBvH-hAb5_oQGv4GFBsqBhQbMgYUGlISFBrWEhQbRhIUGpYWFBraGhQbihoUGsIeFBsOHhQaBiIUGg4iFBpGJhQbviYUG8YmFBiizxYeB9yw6JGJjMTI0N2I3LTlkNTctNDU2OC04Njk3LWUxNWU5MzhiMzdjZUABSAA:S:ANO1ljJIwmN8ak-iGw; SID=yAaxOlTdiyumZkI_ePhv9dHhBcW5v8bR7xbtFsjrdfkSVKDgqzl8uwI0VvjxMDpgH30Kyw.; HSID=AEFU16U03-Sr2obGj; SSID=AYqursHxEOSwBCU0g; APISID=f_AfpjrJVvCSBK_j/A7p9gDICieFA2blrA; SAPISID=GYcU7EVvh2rtCfkx/APnLnU4L0sWAzFZ84; S=billing-ui-v3=P1AlfnpGq8lJ3DbNUleaDU57ricxRIFK:billing-ui-v3-efe=P1AlfnpGq8lJ3DbNUleaDU57ricxRIFK; OTZ=4885256_48_52_123900_48_436380; NID=181=ktY06CEs-LcR-hQi0wWRRnuiwrQdQti5CUff33U6pycIpTKYB-95GBaR3TtzEDremxx2uNcp1akD_lobSW7fFrqoaT_yHRgrJxbAiW_JHwpsGoE4GSqpwZXXLmYTrjptRe0SHiwjGCr2TYb9pkDWWMzxtxwbgtA60tpPNVXacgDWvePtpZElHX2Vb05XuIc4pNyX-OtCfpTHRhaf1mpaWvb2bLW8AH0HA9pvY8GwBGTooTcU3BpXtx6Mnf76T2ZApTmtmuRFJeLZWKpVK6KQ1wN4kJIj5KKdc2ejcjY8Q_k5U82aKSM; 1P_JAR=2019-4-18-0; SIDCC=AN0-TYsdAQ2kdCWXbhD0dSwGZVWDfk9JID07B2bssf1zrL7ae6gTRLL7OJAXt304bcnbjW1LC3WM' -H 'dnt: 1' --data 'f.req=%5B%5B%5B%22xdSrCf%22%2C%22%5B%5Bnull%2C%5B%5C%22org.telegram.messenger%5C%22%2C7%5D%2C%5B%5D%5D%5D%22%2Cnull%2C%22IZBjA%3A0%7CFB%22%5D%5D%5D&at=AK6RGVaFwAQEDXDk6EMgEcrCOv3O%3A1555548771385&' --compressed


function permissions (opts) {
  return new Promise(function (resolve, reject) {
    if (!opts && !opts.appId) {
      throw Error('appId missing');
    }

    const options = Object.assign({
      method: 'POST',
      url: 'https://play.google.com/store/xhr/getdoc?authuser=0',
      form: {
        ids: opts.appId,
        hl: opts.lang || 'en',
        xhr: 1
      },
      followAllRedirects: true
    }, opts.requestOptions);

    request(options, opts.throttle)
    .then(function (res) {
      // remove leading garbage and insert nulls in missing array elements
      res = res.slice(5).replace(/,,/g, ',null,').replace(/,,/g, ',null,').replace(/\[,/g, '[null,');
      res = JSON.parse(res);
      // grab the array that contains all the permission definitions
      // this doesnt look too solid but well
      return res[0][2][0][65]['42656262'][1] || [];
    })
    .then(parsePermissions)
    .then((perms) => {
      if (opts.short) {
        return R.pluck('permission', perms);
      }
      return perms;
    })
    .then(resolve)
    .catch(reject);
  });
}